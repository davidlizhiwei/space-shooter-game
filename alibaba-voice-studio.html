<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>é˜¿é‡Œäº‘è¯­éŸ³å·¥ä½œå®¤</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 800px;
      margin: 0 auto;
      background: white;
      border-radius: 25px;
      padding: 40px;
      box-shadow: 0 25px 80px rgba(0, 0, 0, 0.3);
    }

    .header {
      text-align: center;
      margin-bottom: 30px;
    }

    .logo-badge {
      display: inline-block;
      padding: 8px 16px;
      background: linear-gradient(135deg, #ff6a00, #ff9500);
      color: white;
      border-radius: 20px;
      font-size: 12px;
      font-weight: bold;
      margin-bottom: 15px;
    }

    h1 {
      color: #333;
      font-size: 28px;
      margin-bottom: 10px;
    }

    .subtitle {
      color: #888;
      font-size: 14px;
    }

    /* é€‰é¡¹å¡ */
    .tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 30px;
      border-bottom: 2px solid #eee;
      padding-bottom: 15px;
    }

    .tab {
      flex: 1;
      padding: 12px 20px;
      background: #f5f7fa;
      border: none;
      border-radius: 12px;
      font-size: 15px;
      font-weight: 600;
      color: #666;
      cursor: pointer;
      transition: all 0.3s;
    }

    .tab.active {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
    }

    .tab:hover:not(.active) {
      background: #e4e8ec;
    }

    /* å†…å®¹åŒºåŸŸ */
    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }

    /* è¾“å…¥åŒºåŸŸ */
    .input-section {
      margin-bottom: 25px;
    }

    label {
      display: block;
      color: #555;
      font-weight: 600;
      margin-bottom: 10px;
    }

    textarea {
      width: 100%;
      min-height: 120px;
      padding: 15px;
      border: 2px solid #e0e0e0;
      border-radius: 15px;
      font-size: 16px;
      resize: vertical;
      font-family: inherit;
      transition: border-color 0.3s;
    }

    textarea:focus {
      outline: none;
      border-color: #667eea;
    }

    /* é€‰é¡¹ */
    .options-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
      margin-bottom: 25px;
    }

    select {
      width: 100%;
      padding: 12px;
      border: 2px solid #e0e0e0;
      border-radius: 10px;
      font-size: 14px;
      background: white;
      cursor: pointer;
    }

    select:focus {
      outline: none;
      border-color: #667eea;
    }

    /* æŒ‰é’® */
    .action-btn {
      width: 100%;
      padding: 16px;
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
      border: none;
      border-radius: 15px;
      font-size: 18px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 10px;
    }

    .action-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
    }

    .action-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .action-btn.success {
      background: linear-gradient(135deg, #11998e, #38ef7d);
    }

    /* çŠ¶æ€åŒºåŸŸ */
    .status-area {
      margin-top: 25px;
      padding: 20px;
      background: #f5f7fa;
      border-radius: 15px;
      display: none;
    }

    .status-area.show {
      display: block;
    }

    .status-indicator {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 15px;
    }

    .status-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: #ffd700;
      animation: pulse 1s ease-in-out infinite;
    }

    .status-dot.success { background: #38ef7d; }
    .status-dot.error { background: #ff4757; }

    @keyframes pulse {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.5; transform: scale(1.2); }
    }

    .status-text {
      font-weight: 600;
      color: #333;
    }

    /* éŸ³é¢‘æ’­æ”¾å™¨ */
    .audio-player {
      width: 100%;
      margin-top: 15px;
    }

    /* ä¸Šä¼ åŒºåŸŸ */
    .upload-area {
      border: 3px dashed #ccc;
      border-radius: 15px;
      padding: 40px 20px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s;
      background: #fafafa;
      margin-bottom: 20px;
    }

    .upload-area:hover {
      border-color: #667eea;
      background: #f0f4ff;
    }

    .upload-icon {
      font-size: 50px;
      margin-bottom: 15px;
    }

    .upload-text {
      color: #666;
      font-size: 15px;
    }

    .upload-hint {
      color: #999;
      font-size: 13px;
      margin-top: 8px;
    }

    .file-input {
      display: none;
    }

    /* ç»“æœæ–‡æœ¬ */
    .result-text {
      width: 100%;
      min-height: 150px;
      padding: 15px;
      border: 2px solid #e0e0e0;
      border-radius: 12px;
      font-size: 15px;
      line-height: 1.8;
      color: #333;
      resize: vertical;
      font-family: inherit;
      margin-top: 15px;
    }

    /* æç¤º */
    .tip {
      background: #e8f4fd;
      padding: 15px;
      border-radius: 10px;
      margin-top: 20px;
      font-size: 13px;
      color: #0366d6;
      line-height: 1.6;
    }

    .tip strong {
      color: #0366d6;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="logo-badge">ğŸ™ï¸ é˜¿é‡Œäº‘ç™¾ç‚¼</div>
      <h1>è¯­éŸ³å·¥ä½œå®¤</h1>
      <p class="subtitle">Qwen3-TTS è¯­éŸ³åˆæˆ Â· Fun-ASR è¯­éŸ³è¯†åˆ«</p>
    </div>

    <!-- é€‰é¡¹å¡ -->
    <div class="tabs">
      <button class="tab active" onclick="switchTab('tts')">ğŸ”Š æ–‡å­—è½¬è¯­éŸ³</button>
      <button class="tab" onclick="switchTab('stt')">ğŸ¤ è¯­éŸ³è½¬æ–‡å­—</button>
    </div>

    <!-- æ–‡å­—è½¬è¯­éŸ³ -->
    <div class="tab-content active" id="tts-content">
      <div class="input-section">
        <label for="tts-text">è¾“å…¥æ–‡å­—</label>
        <textarea
          id="tts-text"
          placeholder="è¯·è¾“å…¥è¦è½¬æ¢çš„æ–‡å­—ï¼Œæ”¯æŒä¸­æ–‡ã€è‹±æ–‡ç­‰å¤šç§è¯­è¨€..."
          maxlength="5000"
        >ä½ å¥½ï¼è¿™æ˜¯é˜¿é‡Œäº‘é€šä¹‰åƒé—®è¯­éŸ³åˆæˆæµ‹è¯•ã€‚æ¬¢è¿ä½¿ç”¨ Fun-ASR å’Œ Qwen-TTS è¯­éŸ³æœåŠ¡ï¼</textarea>
      </div>

      <div class="options-grid">
        <div>
          <label for="tts-model">é€‰æ‹©æ¨¡å‹</label>
          <select id="tts-model">
            <option value="qwen3-tts-flash-realtime">Qwen3-TTS Flash (å®æ—¶)</option>
            <option value="qwen3-tts-instruct-flash-realtime">Qwen3-TTS Instruct (æŒ‡ä»¤)</option>
            <option value="cosyvoice-v2">CosyVoice v2</option>
          </select>
        </div>
        <div>
          <label for="tts-voice">é€‰æ‹©éŸ³è‰²</label>
          <select id="tts-voice">
            <option value="Cherry">Cherry (å¥³å£° - æ¸©æŸ”)</option>
            <option value="Bella">Bella (å¥³å£° - çŸ¥æ€§)</option>
            <option value="Ethan">Ethan (ç”·å£° - æ²‰ç¨³)</option>
            <option value="longshu_v2">é¾™ä¹¦ (ç”·å£° - æ–°é—»)</option>
            <option value="loongbella_v2">Bella v2 (å¥³å£° - æ–°é—»)</option>
          </select>
        </div>
      </div>

      <button class="action-btn" id="tts-btn" onclick="generateSpeech()">
        <span>ğŸ”Š</span>
        <span>ç”Ÿæˆè¯­éŸ³</span>
      </button>

      <div class="status-area" id="tts-status">
        <div class="status-indicator">
          <div class="status-dot" id="tts-dot"></div>
          <span class="status-text" id="tts-status-text">æ­£åœ¨ç”Ÿæˆ...</span>
        </div>
        <audio class="audio-player" id="tts-audio" controls style="display: none;"></audio>
      </div>

      <div class="tip">
        <strong>ğŸ’¡ ä½¿ç”¨è¯´æ˜ï¼š</strong><br>
        â€¢ ä½¿ç”¨ WebSocket å®æ—¶åˆæˆï¼Œé¦–éŸ³å»¶è¿Ÿçº¦ 376ms<br>
        â€¢ æ”¯æŒæµå¼æ–‡æœ¬è¾“å…¥ï¼Œå¯åˆ†æ®µå‘é€é•¿æ–‡æœ¬<br>
        â€¢ ç”Ÿæˆçš„éŸ³é¢‘ä¸º PCM æ ¼å¼ï¼ˆ24kHz å•å£°é“ 16bitï¼‰
      </div>
    </div>

    <!-- è¯­éŸ³è½¬æ–‡å­— -->
    <div class="tab-content" id="stt-content">
      <div class="upload-area" onclick="document.getElementById('stt-file').click()">
        <div class="upload-icon">ğŸ“</div>
        <div class="upload-text">ç‚¹å‡»æˆ–æ‹–æ‹½ä¸Šä¼ éŸ³é¢‘æ–‡ä»¶</div>
        <div class="upload-hint">æ”¯æŒ MP3, WAV, M4A, FLAC ç­‰æ ¼å¼</div>
      </div>
      <input type="file" id="stt-file" class="file-input" accept="audio/*" onchange="handleFileSelect(event)">

      <div class="options-grid">
        <div>
          <label for="stt-model">é€‰æ‹©æ¨¡å‹</label>
          <select id="stt-model">
            <option value="fun-asr-mtl">Fun-ASR å¤šè¯­è¨€</option>
            <option value="qwen3-asr-flash-realtime-2026-02-10">Qwen3-ASR Flash (å®æ—¶)</option>
            <option value="paraformer-mtl">Paraformer å¤šè¯­è¨€</option>
          </select>
        </div>
        <div>
          <label for="stt-language">è¯†åˆ«è¯­è¨€</label>
          <select id="stt-language">
            <option value="zh-CN">ä¸­æ–‡æ™®é€šè¯</option>
            <option value="zh-HK">ä¸­æ–‡ç²¤è¯­</option>
            <option value="en-US">è‹±è¯­</option>
            <option value="ja-JP">æ—¥è¯­</option>
            <option value="ko-KR">éŸ©è¯­</option>
          </select>
        </div>
      </div>

      <button class="action-btn" id="stt-btn" onclick="recognizeSpeech()">
        <span>ğŸ“</span>
        <span>å¼€å§‹è¯†åˆ«</span>
      </button>

      <div class="status-area" id="stt-status">
        <div class="status-indicator">
          <div class="status-dot" id="stt-dot"></div>
          <span class="status-text" id="stt-status-text">æ­£åœ¨è¯†åˆ«...</span>
        </div>
        <textarea class="result-text" id="stt-result" readonly placeholder="è¯†åˆ«ç»“æœå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ..."></textarea>
      </div>

      <div class="tip">
        <strong>ğŸ’¡ ä½¿ç”¨è¯´æ˜ï¼š</strong><br>
        â€¢ æ”¯æŒ 30 ç§è¯­è¨€å’Œ 22 ç§ä¸­æ–‡æ–¹è¨€è¯†åˆ«<br>
        â€¢ Fun-ASR æ˜¯é˜¿é‡Œå¼€æºçš„é«˜ç²¾åº¦è¯­éŸ³è¯†åˆ«å¼•æ“<br>
        â€¢ å®æ—¶è¯†åˆ«å»¶è¿Ÿä½ï¼Œé€‚åˆåœ¨çº¿ä¼šè®®ã€ç›´æ’­ç­‰åœºæ™¯
      </div>
    </div>
  </div>

  <script>
    // åˆ‡æ¢é€‰é¡¹å¡
    function switchTab(tab) {
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));

      document.querySelector(`.tab:nth-child(${tab === 'tts' ? '1' : '2'})`).classList.add('active');
      document.getElementById(`${tab}-content`).classList.add('active');
    }

    // æ–‡å­—è½¬è¯­éŸ³
    async function generateSpeech() {
      const text = document.getElementById('tts-text').value.trim();
      const model = document.getElementById('tts-model').value;
      const voice = document.getElementById('tts-voice').value;

      if (!text) {
        alert('è¯·è¾“å…¥è¦è½¬æ¢çš„æ–‡å­—');
        return;
      }

      // æ˜¾ç¤ºçŠ¶æ€
      const statusArea = document.getElementById('tts-status');
      const statusDot = document.getElementById('tts-dot');
      const statusText = document.getElementById('tts-status-text');
      const audioPlayer = document.getElementById('tts-audio');
      const btn = document.getElementById('tts-btn');

      statusArea.classList.add('show');
      statusDot.className = 'status-dot';
      statusText.textContent = 'æ­£åœ¨è¿æ¥ WebSocket...';
      audioPlayer.style.display = 'none';
      btn.disabled = true;

      // è°ƒç”¨åç«¯ APIï¼ˆéœ€è¦éƒ¨ç½²æœåŠ¡å™¨ï¼‰
      // æ³¨æ„ï¼šç”±äºæµè§ˆå™¨é™åˆ¶ï¼ŒWebSocket è°ƒç”¨éœ€è¦é€šè¿‡åç«¯æœåŠ¡
      try {
        // è¿™é‡Œæ˜¯ç¤ºä¾‹ä»£ç ï¼Œå®é™…éœ€è¦åç«¯æœåŠ¡é…åˆ
        const response = await fetch('/api/tts', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ text, model, voice })
        });

        if (response.ok) {
          const blob = await response.blob();
          const url = URL.createObjectURL(blob);
          audioPlayer.src = url;
          audioPlayer.style.display = 'block';
          statusDot.className = 'status-dot success';
          statusText.textContent = 'ç”ŸæˆæˆåŠŸï¼';
        } else {
          throw new Error('ç”Ÿæˆå¤±è´¥');
        }
      } catch (error) {
        statusDot.className = 'status-dot error';
        statusText.textContent = 'ç”Ÿæˆå¤±è´¥ï¼š' + error.message;
      }

      btn.disabled = false;
    }

    // è¯­éŸ³è½¬æ–‡å­—
    async function recognizeSpeech() {
      const fileInput = document.getElementById('stt-file');
      const model = document.getElementById('stt-model').value;
      const language = document.getElementById('stt-language').value;

      if (!fileInput.files.length) {
        alert('è¯·å…ˆä¸Šä¼ éŸ³é¢‘æ–‡ä»¶');
        return;
      }

      const file = fileInput.files[0];
      const statusArea = document.getElementById('stt-status');
      const statusDot = document.getElementById('stt-dot');
      const statusText = document.getElementById('stt-status-text');
      const resultText = document.getElementById('stt-result');
      const btn = document.getElementById('stt-btn');

      statusArea.classList.add('show');
      statusDot.className = 'status-dot';
      statusText.textContent = 'æ­£åœ¨ä¸Šä¼ å¹¶è¯†åˆ«...';
      resultText.value = '';
      btn.disabled = true;

      // è°ƒç”¨åç«¯ APIï¼ˆéœ€è¦éƒ¨ç½²æœåŠ¡å™¨ï¼‰
      try {
        const formData = new FormData();
        formData.append('audio', file);
        formData.append('model', model);
        formData.append('language', language);

        const response = await fetch('/api/stt', {
          method: 'POST',
          body: formData
        });

        if (response.ok) {
          const result = await response.json();
          resultText.value = result.text || '';
          statusDot.className = 'status-dot success';
          statusText.textContent = 'è¯†åˆ«æˆåŠŸï¼';
        } else {
          throw new Error('è¯†åˆ«å¤±è´¥');
        }
      } catch (error) {
        statusDot.className = 'status-dot error';
        statusText.textContent = 'è¯†åˆ«å¤±è´¥ï¼š' + error.message;
      }

      btn.disabled = false;
    }

    // æ–‡ä»¶é€‰æ‹©å¤„ç†
    function handleFileSelect(event) {
      const file = event.target.files[0];
      if (file) {
        const uploadText = document.querySelector('.upload-text');
        uploadText.textContent = `å·²é€‰æ‹©ï¼š${file.name} (${(file.size / 1024 / 1024).toFixed(2)} MB)`;
      }
    }
  </script>
</body>
</html>
